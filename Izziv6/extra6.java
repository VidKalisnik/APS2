import java.util.Random;

class Matrix {

  private int[][] m;

  public int n; //only square matrices

  public Matrix(int n) {
    this.n = n;

    m = new int[n][n];
  }

  //set value at i,j
  public void setV(int i, int j, int val) {
    m[i][j] = val;
  }

  // get value at index i,j
  public int v(int i, int j) {
    return m[i][j];
  }

  public void setAllRandom() {
    Random rand = new Random();
    for (int i = 0; i < m.length; i++) {
      for (int j = 0; j < m.length; j++) {
        setV(i, j, rand.nextInt(1));
      }
    }
  }

  // return a square submatrix from this
  public Matrix getSubmatrix(int startRow, int startCol, int dim) {
    Matrix subM = new Matrix(dim);

    for (int i = 0; i < dim; i++) for (int j = 0; j < dim; j++) subM.setV(
      i,
      j,
      m[startRow + i][startCol + j]
    );

    return subM;
  }

  // write this matrix as a submatrix from b (useful for the result of multiplication)
  public void putSubmatrix(int startRow, int startCol, Matrix b) {
    for (int i = 0; i < b.n; i++) for (int j = 0; j < b.n; j++) setV(
      startRow + i,
      startCol + j,
      b.v(i, j)
    );
  }

  // matrix addition
  public Matrix sum(Matrix b) {
    Matrix c = new Matrix(n);

    for (int i = 0; i < n; i++) {
      for (int j = 0; j < n; j++) {
        c.setV(i, j, m[i][j] + b.v(i, j));
      }
    }

    return c;
  }

  // matrix subtraction
  public Matrix sub(Matrix b) {
    Matrix c = new Matrix(n);

    for (int i = 0; i < n; i++) {
      for (int j = 0; j < n; j++) {
        c.setV(i, j, m[i][j] - b.v(i, j));
      }
    }

    return c;
  }

  public int sumM() {
    int sum = 0;

    for (int i = 0; i < n; i++) {
      for (int j = 0; j < n; j++) {
        sum += m[i][j];
      }
    }

    return sum;
  }

  //simple multiplication
  public Matrix mult(Matrix b) {
    Matrix C = new Matrix(n);

    for (int i = 0; i < n; i++) {
      for (int j = 0; j < n; j++) {
        for (int k = 0; k < n; k++) {
          C.setV(i, j, C.v(i, j) + m[i][k] * b.v(k, j));
        }
      }
    }

    return C;
  }

  // Strassen multiplication
  public Matrix multStrassen(Matrix b, int cutoff) {
    if (cutoff >= n) {
      return this.mult(b);
    }

    int mid = n / 2;

    Matrix a11 = this.getSubmatrix(0, 0, mid);
    Matrix a12 = this.getSubmatrix(0, mid, mid);
    Matrix a21 = this.getSubmatrix(mid, 0, mid);
    Matrix a22 = this.getSubmatrix(mid, mid, mid);

    Matrix b11 = b.getSubmatrix(0, 0, mid);
    Matrix b12 = b.getSubmatrix(0, mid, mid);
    Matrix b21 = b.getSubmatrix(mid, 0, mid);
    Matrix b22 = b.getSubmatrix(mid, mid, mid);

    Matrix m1 = (a11.sum(a22)).multStrassen(b11.sum(b22), cutoff);
    Matrix m2 = (a21.sum(a22)).multStrassen(b11, cutoff);
    Matrix m3 = (a11).multStrassen(b12.sub(b22), cutoff);
    Matrix m4 = (a22).multStrassen(b21.sub(b11), cutoff);
    Matrix m5 = (a11.sum(a12)).multStrassen(b22, cutoff);
    Matrix m6 = (a21.sub(a11)).multStrassen(b11.sum(b12), cutoff);
    Matrix m7 = (a12.sub(a22)).multStrassen(b21.sum(b22), cutoff);

    /*System.out.println("m1: " + m1.sumM());
    System.out.println("m2: " + m2.sumM());
    System.out.println("m3: " + m3.sumM());
    System.out.println("m4: " + m4.sumM());
    System.out.println("m5: " + m5.sumM());
    System.out.println("m6: " + m6.sumM());
    System.out.println("m7: " + m7.sumM());*/

    Matrix c11 = ((m1.sum(m4)).sub(m5)).sum(m7);
    Matrix c12 = m3.sum(m5);
    Matrix c21 = m2.sum(m4);
    Matrix c22 = ((m1.sub(m2)).sum(m3)).sum(m6);

    Matrix c = new Matrix(n);

    c.putSubmatrix(0, 0, c11);
    c.putSubmatrix(0, mid, c12);
    c.putSubmatrix(mid, 0, c21);
    c.putSubmatrix(mid, mid, c22);

    return c;
  }

  public void printMatrix() {
    for (int i = 0; i < m.length; i++) {
      for (int j = 0; j < m.length; j++) {
        System.out.print(m[i][j] + " ");
      }
      System.out.println();
    }
  }
}

public class extra6 {

  public static void main(String[] args) {
    // Warmup
    Matrix tmp = new Matrix(128);
    tmp.mult(tmp);
    tmp.multStrassen(tmp, 16);
    //

    System.out.println("   n     |    normal    |   strassen   |");
    System.out.println("---------+--------------+---------------");
    int n = 1;

    int cutoff = 1;

    while (true) {
      Matrix a = new Matrix(n);
      Matrix b = new Matrix(n);
      a.setAllRandom();
      b.setAllRandom();

      //time for normal *
      long startTime = System.nanoTime();
      a.mult(b);
      long normalMultiplication = System.nanoTime() - startTime;

      //time for normal S*
      startTime = System.nanoTime();
      a.multStrassen(b, cutoff);
      long strassenMultiplication = System.nanoTime() - startTime;

      System.out.printf(
        "%8d | %12d | %13d\n",
        n,
        normalMultiplication,
        strassenMultiplication
      );

      if (strassenMultiplication < normalMultiplication) {
        System.out.println("---------+--------------+---------------");
        System.out.println("---------+----slower----+----faster-----");
        System.out.println("---------+--------------+---------------");
      }

      n = n * 2;
    }
  }
}
/*
 * Results
 * 
 * cutoff = 8
 *  Normal is faster till the size of matrix reaches 508x508.
   n     |    normal    |   strassen   |
---------+--------------+---------------
      10 |         4651 |         33666
      11 |        17850 |         59327
      12 |         5594 |         45344
      13 |         5893 |         40947
      14 |         9675 |         80515
      15 |        14708 |        133654
      16 |        20954 |        105845
      17 |        22983 |        221083
      18 |        24641 |        464217
      19 |        28168 |        494119
      20 |        35932 |        568822
      21 |        29610 |        565972
      22 |        24273 |        364977
      23 |        19452 |        272930
      24 |        21879 |        365334
      25 |        24718 |        356724
      26 |        30830 |        378614
      27 |        32831 |        395404
      28 |        36127 |        461353
      29 |        39212 |        462841
      30 |        76784 |        955072
      31 |        74627 |        886065
      32 |        92585 |        843768
      33 |       104937 |        840694
      34 |       101155 |        569881
      35 |        65488 |        506838
      36 |        71953 |       1487931
      37 |        75046 |       1443237
      38 |        80830 |       2391717
      39 |       156144 |       2309806
      40 |       169827 |       2530209
      41 |       187104 |       2627702
      42 |       118591 |       1547430
      43 |       217365 |       2987455
      44 |       357798 |       1837352
      45 |      4484080 |       9893576
      46 |       208872 |       6044793
      47 |       247198 |      10066065
      48 |       281081 |      16130567
      49 |       284190 |       2653617
      50 |       302222 |       2219380
      51 |       183623 |      13302620
      52 |       589762 |       2857725
      53 |      1267736 |       2794856
      54 |       384037 |       3051378
      55 |       361768 |       2595798
      56 |       474278 |      61581291
      57 |       484876 |       3904756
      58 |      1425736 |       1952915
      59 |       494152 |      30194660
      60 |       310181 |       2013373
      61 |       318227 |      28162084
      62 |       980294 |       8992503
      63 |       632951 |      13252123
      64 |       634872 |       6554093
      65 |       383202 |       8328137
      66 |       409937 |       6271215
      67 |      2872025 |      50856349
      68 |      1904540 |       6105705
      69 |       983642 |       6715722
      70 |       718115 |       4114536
      71 |       904098 |       6123946
      72 |       990561 |      16958124
      73 |       892494 |      29962939
      74 |       995628 |      34086333
      75 |      5009740 |       9139393
      76 |      1464209 |      13425645
      77 |      1113464 |      12110617
      78 |      1140776 |      30560418
      79 |      8510153 |      14903705
      80 |      1533680 |      20926869
      81 |      1266513 |      13062022
      82 |      1277610 |      15339975
      83 |      2697720 |      27414838
      84 |      5479729 |      27964318
      85 |      4957995 |      16124469
      86 |      2794963 |      21557672
      87 |      1625002 |      15285346
      88 |      1169071 |      14461717
      89 |      1291830 |      14778527
      90 |      2117532 |      15468088
      91 |      1272211 |      14665373
      92 |      1254193 |      15564467
      93 |      2357147 |      17749182
      94 |      1434228 |      14437643
      95 |      1249117 |      14754170
      96 |      1573580 |      16740074
      97 |      2175584 |      20682108
      98 |      2817534 |      25228886
      99 |      1372775 |      14139738
     100 |      4363022 |      20724165
     101 |      1907118 |      22950707
     102 |      1624342 |      18323609
     103 |      6704351 |      17914334
     104 |      2982254 |      22829533
     105 |      1749330 |      17430335
     106 |      3342236 |      12122197
     107 |      1720652 |      19143126
     108 |      3214674 |      17427307
     109 |      6768347 |      18305259
     110 |      2380584 |      22123014
     111 |      2514798 |      16041629
     112 |      2832865 |      32386200
     113 |      5394169 |      42858310
     114 |     10613286 |      45822845
     115 |      2597223 |      32959116
     116 |      9310067 |      48581491
     117 |      3953750 |      24207335
     118 |      5458801 |      35814676
     119 |      6024696 |      28218268
     120 |      3951409 |      27959159
     121 |      3781143 |      28933182
     122 |      7748883 |      29578460
     123 |     17250676 |      47714734
     124 |     16722965 |      37577388
     125 |      4673901 |      24711118
     126 |      4024222 |      29281706
     127 |      4521336 |      19039224
     128 |      3425281 |      64656808
     129 |     16368650 |      21262682
     130 |      6019992 |      24133845
     131 |      3239255 |      28654865
     132 |      3581967 |      28367487
     133 |      3493945 |      31618595
     134 |      6668926 |      22022589
     135 |      9643398 |      22242997
     136 |      6488764 |      30610671
     137 |      3654548 |      28368310
     138 |      9934809 |      29033814
     139 |      3904169 |     104043626
     140 |     17807826 |      22295544
     141 |      7120846 |      15556010
     142 |      5274993 |      14845224
     143 |      6698609 |      13267222
     144 |      6994529 |      52347146
     145 |      7688621 |      56344285
     146 |      4082919 |      50185913
     147 |      6118764 |      52168868
     148 |      4908824 |      50322955
     149 |      5569378 |      48696112
     150 |      5000754 |      47515845
     151 |      5741613 |      50222615
     152 |      5311828 |      48167358
     153 |      6186924 |      64082826
     154 |      4996942 |      48210342
     155 |      8177812 |      45202185
     156 |      8094175 |      47173232
     157 |      5966186 |      46249284
     158 |      5711034 |      49537733
     159 |      7913246 |      48696285
     160 |      5552253 |      61245120
     161 |      5704287 |      60660474
     162 |     12705837 |      52731681
     163 |      7823090 |      58545109
     164 |     10664473 |      52659789
     165 |     11466599 |      55458263
     166 |      8153974 |      56319176
     167 |     11007304 |      57243588
     168 |      6755363 |      55274529
     169 |      8942770 |      57568599
     170 |      7900573 |      55304998
     171 |      9188030 |      53284786
     172 |      8020978 |      51989504
     173 |     10686355 |      52015155
     174 |      8131817 |      54656013
     175 |      8186083 |      54006913
     176 |      9580037 |      55575487
     177 |      7874338 |      57348025
     178 |     10399739 |      53910134
     179 |      9094726 |      57303137
     180 |      8183272 |      54969852
     181 |     12456463 |      54993631
     182 |      9809269 |      55364081
     183 |     10313708 |      57814238
     184 |      8476367 |      55507361
     185 |     11645314 |      57068561
     186 |      8916872 |      54805279
     187 |     13607105 |      56477567
     188 |     16100236 |      66000770
     189 |      9367216 |      58567756
     190 |     12039135 |      77008407
     191 |     19124772 |      57413783
     192 |     13862412 |      66108905
     193 |     12225217 |      64460125
     194 |     12220809 |      91609461
     195 |     23057927 |      75042328
     196 |     10984828 |      91542330
     197 |     28294735 |      92369283
     198 |     14176121 |      66307318
     199 |     10998021 |      67419808
     200 |     14134146 |      68065215
     201 |     18596245 |      67120838
     202 |     15779886 |      73490258
     203 |     14310893 |      67407754
     204 |     13366095 |      66345482
     205 |     15076623 |      64605358
     206 |     15737084 |      66517515
     207 |     15031974 |      62535837
     208 |     14448527 |      63054026
     209 |     13303302 |      64636659
     210 |     15397638 |      64948977
     211 |     13075738 |      63025099
     212 |     15041796 |      61200290
     213 |     15999738 |      61830518
     214 |     16109755 |      61939871
     215 |     14531790 |      67096304
     216 |     13849667 |      66062106
     217 |     16145596 |      77447193
     218 |     18827808 |      79947574
     219 |     21842438 |      65417720
     220 |     21930417 |      63775093
     221 |     20216194 |      65932473
     222 |     19059900 |      62546077
     223 |     19596712 |      65260132
     224 |     24109638 |      77509585
     225 |     19944115 |      72922601
     226 |     19831214 |      73176283
     227 |     18545565 |      73540741
     228 |     20942419 |      74137602
     229 |     46649370 |     115879983
     230 |     23939640 |      73351680
     231 |     22166969 |      72895520
     232 |     23896537 |      77590949
     233 |     22759136 |      77494735
     234 |     27133656 |      84731705
     235 |     28707845 |      77604242
     236 |     22220273 |      75073510
     237 |     23983682 |      71681702
     238 |     26528562 |      72084186
     239 |     23888885 |      69628309
     240 |     26094124 |      72247841
     241 |     26220300 |      70266619
     242 |     33155112 |      70092082
     243 |     25426266 |      71235290
     244 |     30359410 |      71783174
     245 |     28473960 |      69140857
     246 |     27175647 |      76501611
     247 |     34208199 |      97681779
     248 |     34467224 |     101127970
     249 |     62870550 |      70579286
     250 |     32770008 |      75052644
     251 |     40354347 |      72918904
     252 |     44375163 |      73784604
     253 |     33497604 |      73217733
     254 |     30456536 |      73762536
     255 |     37774739 |      74920441
     256 |     35823084 |      85703314
     257 |     35710573 |      82723905
     258 |     36460954 |      84046856
     259 |     35074728 |      87390126
     260 |     38069038 |      86698923
     261 |     37356370 |      83611616
     262 |     41088478 |      83781306
     263 |     40301334 |      84398724
     264 |     47216029 |      83739348
     265 |     41522018 |      83607480
     266 |     42696192 |      80319790
     267 |     42754041 |      83066455
     268 |     44786631 |      84299135
     269 |     47442198 |      79280433
     270 |     53033176 |     156226839
     271 |     46894418 |      82787932
     272 |     47668288 |      81266983
     273 |     50805905 |      81268497
     274 |     48908726 |      86276618
     275 |     54120653 |      84137713
     276 |     51829349 |      87283784
     277 |     56399213 |      84361447
     278 |     55167224 |      88471691
     279 |     54162969 |      81856283
     280 |     55970471 |      93010603
     281 |     68744960 |      90846691
     282 |     66651843 |      83792372
     283 |     56023771 |      96364697
     284 |     73537597 |     110065506
     285 |     88538634 |      99218787
     286 |     65303778 |      85805684
     287 |     68135417 |      86743547
     288 |     60664264 |     287561479
     289 |     56797008 |     277470821
     290 |     60106800 |     286076018
     291 |     60402802 |     281250226
     292 |     68426026 |     278018675
     293 |     62012230 |     274022634
     294 |     66981743 |     289632415
     295 |     63936264 |     273315894
     296 |     66300315 |     280278472
     297 |     65427178 |     290115152
     298 |     74542854 |     289576183
     299 |     74349865 |     281301217
     300 |     86906318 |     350670242
     301 |     69125853 |     279870529
     302 |     69125170 |     277355036
     303 |     70137197 |     282511865
     304 |     70969645 |     277899505
     305 |     75492037 |     284101664
     306 |     74225834 |     278971828
     307 |     75963590 |     280635420
     308 |     75487221 |     274082534
     309 |     78772490 |     281117943
     310 |     79163391 |     276452293
     311 |     78059602 |     271523702
     312 |     78072206 |     297540184
     313 |     78422871 |     288253955
     314 |    108146324 |     342289296
     315 |     84463642 |     293984420
     316 |     84787929 |     283355532
     317 |     83771372 |     335890902
     318 |     87925564 |     287089080
     319 |     94239936 |     284489837
     320 |     86933146 |     339626164
     321 |     83055511 |     330427682
     322 |     87125707 |     337714310
     323 |     87889179 |     347346926
     324 |     95666094 |     363525815
     325 |     99017833 |     365618639
     326 |    106080237 |     377703682
     327 |     94235760 |     349082484
     328 |     92158313 |     326864191
     329 |     91170495 |     335895724
     330 |     98244206 |     352247253
     331 |     99050777 |     332496227
     332 |     95825343 |     347502008
     333 |     97674318 |     344659834
     334 |     97932220 |     339692567
     335 |    102377966 |     346364210
     336 |    112950522 |     360520022
     337 |    132257404 |     386737661
     338 |     94222659 |     336385180
     339 |    100679000 |     343261983
     340 |    102987668 |     333931816
     341 |    102728319 |     336194239
     342 |    104337592 |     337714835
     343 |    102685168 |     337757881
     344 |    184024943 |     343555245
     345 |    109653352 |     354042789
     346 |    110295777 |     334019930
     347 |    101125758 |     355830386
     348 |    130901988 |     362264925
     349 |    113413561 |     334663949
     350 |    108270718 |     338085267
     351 |    109450903 |     350768145
     352 |    114205868 |     357392517
     353 |    119004819 |     347228356
     354 |    116277028 |     344259083
     355 |    113167319 |     349124670
     356 |    116960830 |     348658886
     357 |    119441808 |     356995107
     358 |    122350033 |     454337484
     359 |    126146246 |     348148248
     360 |    130374384 |     383386191
     361 |    140108276 |     344976057
     362 |    123052524 |     345222033
     363 |    124585574 |     344194832
     364 |    128926346 |     347886601
     365 |    128701851 |     340344406
     366 |    131488484 |     344239711
     367 |    125606524 |     340484138
     368 |    126673828 |     428094325
     369 |    137536955 |     342791997
     370 |    130658697 |     336706311
     371 |    136724802 |     344588177
     372 |    133482675 |     344531568
     373 |    137643285 |     352093941
     374 |    137776088 |     349885035
     375 |    137684987 |     344020880
     376 |    136688099 |     349294907
     377 |    140161152 |     352883259
     378 |    148460939 |     387611089
     379 |    209115167 |     364404710
     380 |    175101565 |     354633503
     381 |    183098926 |     351015924
     382 |    159971829 |     348698628
     383 |    152681412 |     348067484
     384 |    148517545 |     399045941
     385 |    147929583 |     405705319
     386 |    152987527 |     410306306
     387 |    163510742 |     484348148
     388 |    158905240 |     400075625
     389 |    160615669 |     411387020
     390 |    158973438 |     401914884
     391 |    168236154 |     398024090
     392 |    161204788 |     404255756
     393 |    159970577 |     394634104
     394 |    159002953 |     405944558
     395 |    163035603 |     412070117
     396 |    197844565 |     447513861
     397 |    172692626 |     420855102
     398 |    177017891 |     425312634
     399 |    169480480 |     407290194
     400 |    167834783 |     395884727
     401 |    175376358 |     400779725
     402 |    172999358 |     400961952
     403 |    180475377 |     405953093
     404 |    173412703 |     472214563
     405 |    177100043 |     402654147
     406 |    181215220 |     414767288
     407 |    179760680 |     400573776
     408 |    191358937 |     400962335
     409 |    185234275 |     400460761
     410 |    186572996 |     407136625
     411 |    188497025 |     405584112
     412 |    185487031 |     426053572
     413 |    250749625 |     419085536
     414 |    202908423 |     419901847
     415 |    184916729 |     409522823
     416 |    198850669 |     428487871
     417 |    191858822 |     420297917
     418 |    186909900 |     421794226
     419 |    204480916 |     412274104
     420 |    195355918 |     434498706
     421 |    273228124 |     420805535
     422 |    206593858 |     418330669
     423 |    208773158 |     414795241
     424 |    222194326 |     409738783
     425 |    206590004 |     404724841
     426 |    204607335 |     414119367
     427 |    205467652 |     425987940
     428 |    205404589 |     482748221
     429 |    219262841 |     414083214
     430 |    222983509 |     427228761
     431 |    213347375 |     419170536
     432 |    209878172 |     416308563
     433 |    215155351 |     402686268
     434 |    218633613 |     412595646
     435 |    221716359 |     420647257
     436 |    225340019 |     491163867
     437 |    226201498 |     420579910
     438 |    231798634 |     418686009
     439 |    220046239 |     437765392
     440 |    238149411 |     448354512
     441 |    232412958 |     414543880
     442 |    231724804 |     425189077
     443 |    237633862 |     492181953
     444 |    302842296 |     423563258
     445 |    237716225 |     412858956
     446 |    248793726 |     435892198
     447 |    242100714 |     423318815
     448 |    243238452 |     489853471
     449 |    246860892 |     491740791
     450 |    255005317 |     579392612
     451 |    253534742 |     491815522
     452 |    260310210 |     490279927
     453 |    260996458 |     503822844
     454 |    253016994 |     473763430
     455 |    245777595 |     485068849
     456 |    263355879 |     527234568
     457 |    490141622 |     514475278
     458 |    299402110 |     488351258
     459 |    254852529 |     486174410
     460 |    261766438 |     480418190
     461 |    257223075 |     495576301
     462 |    261327060 |     497070191
     463 |    286414948 |     560273610
     464 |    276634719 |     500973141
     465 |    285895522 |     502592454
     466 |    272974970 |     485453226
     467 |    271401059 |     492204206
     468 |    271148410 |     494599532
     469 |    293485179 |     569750721
     470 |    293242986 |     495786513
     471 |    270566491 |     489556943
     472 |    299050644 |     584874656
     473 |    279888621 |     491262014
     474 |    274524260 |     482432931
     475 |    287470053 |     513089096
     476 |    343618242 |     490891947
     477 |    278540484 |     479667531
     478 |    280846081 |     509767539
     479 |    289205150 |     476242035
     480 |    296601382 |     504717382
     481 |    314318345 |     491255079
     482 |    412311043 |     493161152
     483 |    299026019 |     485679802
     484 |    306432284 |     495472332
     485 |    291494606 |     512944306
     486 |    446468249 |     613958045
     487 |    951666440 |    1344504302
     488 |    427965592 |     788372114
     489 |    397275667 |     689265420
     490 |    380417084 |     684831574
     491 |    476950591 |     725581909
     492 |    347341876 |     742692935
     493 |    551754928 |     693948201
     494 |    336784266 |     492765730
     495 |    326484945 |     552043193
     496 |    331268739 |     494167862
     497 |    323195122 |     500887589
     498 |    353418983 |     492888650
     499 |    331888855 |     492419564
     500 |    326841468 |     500231972
     501 |    561004174 |     850719407
     502 |    459112721 |     546563542
     503 |    461161648 |     580350620
     504 |    357036780 |     527670831
     505 |    349668437 |     504892907
     506 |    425689099 |     617063156
     507 |    523239255 |     536033082
     508 |    565679597 |     552643227
 */
